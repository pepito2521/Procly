<main class="nuevo-ticket-container">

  <!-- PROGRESS BAR + BOTÓN VOLVER -->
  <div class="progress-bar-container" id="progressBarContainer">
    <div class="progress-bar-btn-wrapper">
      <button type="button" class="progress-bar-btn hidden" id="progressBarBtn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 256 256" class="chevron-icon">
          <path d="M232,200a8,8,0,0,1-16,0,88.1,88.1,0,0,0-88-88H51.31l34.35,34.34a8,8,0,0,1-11.32,11.32l-48-48a8,8,0,0,1,0-11.32l48-48A8,8,0,0,1,85.66,61.66L51.31,96H128A104.11,104.11,0,0,1,232,200Z"></path>
        </svg>
        <span>Volver</span>
      </button>
    </div>
    <div class="progress-bar-outer">
      <div class="progress-bar-inner" id="progressBar"></div>
    </div>
  </div>

  <!-- CONTENEDOR MULTISTEP -->
  <form class="formulario-ticket" id="multiStepForm">
      <!-- STEP 1: Selección de categoría -->
    <section class="form-step" id="step-1">
      <div class="categoria-grid">
        <!-- Las categorías se cargarán dinámicamente desde Supabase -->
      </div>
    </section>

    <!-- STEP 2: Descripción y adjunto -->
    <section class="form-step" id="step-2" style="display:none">
      <div class="form-group">
        <input type="text" name="nombre" placeholder="Asigná un nombre al ticket" required>
        <textarea type="text" name="descripcion" rows="4" placeholder="Ingresa una breve descripción de lo que necesitas comprar" required></textarea>
        <div class="file-upload-area" id="fileUploadArea">
          <input type="file" id="adjunto" name="adjunto" accept=".pdf,.doc,.docx,.ppt,.pptx,.jpg,.jpeg,.png,.gif" style="display: none;">
          <span class="upload-main-text">Arrastra tu archivo aquí o <strong>haz clic para seleccionar</strong></span>
          <span class="upload-sub-text">PDF, DOC, DOCX, PPT, PPTX, JPG, PNG, GIF (máx. 25MB)</span>
        </div>
        
        <!-- Área para mostrar archivo seleccionado -->
        <div class="file-selected" id="fileSelected" style="display: none;">
          <div class="file-info">
            <div class="file-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256">
                <path d="M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM160,51.31,188.69,80H160ZM200,216H56V40h88V88a8,8,0,0,0,8,8h48V216Z"></path>
              </svg>
            </div>
            <span class="file-name"></span>
            <button type="button" class="file-remove" id="fileRemove">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
                <path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
      <div class="button-group">
        <button type="button" class="btn2 nav-active">
          Siguiente
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
            <path d="M221.66,133.66l-72,72a8,8,0,0,1-11.32-11.32L196.69,136H40a8,8,0,0,1,0-16H196.69L138.34,61.66a8,8,0,0,1,11.32-11.32l72,72A8,8,0,0,1,221.66,133.66Z"></path>
          </svg>
        </button>
      </div>
    </section>

    <!-- STEP 3: Presupuesto y Datos de Entrega -->
    <section class="form-step" id="step-3" style="display:none">
      <div class="form-group">
        <select name="limite" id="limite" required>
          <option value="" selected>¿Querés establecer un presupuesto límite?</option>
          <option value="si">Sí</option>
          <option value="no">No</option>
        </select>
        
        <div id="presupuestoInputGroup" style="display: none;">
          <div class="input-with-unit">
            <input type="text" name="presupuesto" placeholder="Ingresá tu presupuesto máximo (opcional)" />
            <span class="unidad">ARS</span>
          </div>
        </div>

        <select name="direccion_entrega" id="direccion_entrega" required>
          <option value="" selected>Seleccioná la Dirección de Entrega</option>
        </select>                        
        
        <input type="text" id="fecha_entrega" class="input-fecha" name="fecha_entrega" placeholder="Seleccioná la Fecha de Entrega" required>
        <small class="fecha-info" style="color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; display: block; text-align: center;">
          Mínimo 5 días hábiles requeridos para conseguir propuestas (excluyendo sábados y domingos)
        </small>
      </div>

      <div class="button-group">
        <button type="submit" class="btn2 nav-active" id="crearTicketBtn">
          <div class="btn-content">
            Crear Ticket
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
              <path d="M221.66,133.66l-72,72a8,8,0,0,1-11.32-11.32L196.69,136H40a8,8,0,0,1,0-16H196.69L138.34,61.66a8,8,0,0,1,11.32-11.32l72,72A8,8,0,0,1,221.66,133.66Z"></path>
            </svg>
          </div>
          <div class="btn-spinner"></div>
        </button>
      </div>
    </section>
  </form>
</main>
<!-- Pop-up de confirmación de ticket -->
<div id="pop-up-confirmacion-ticket" class="popup-overlay" style="display: none;" aria-modal="true" role="dialog">
  <div class="pop-up-contenido">
    <!-- Header con icono de éxito -->
    <div class="popup-confirmacion-header">
      <div class="popup-confirmacion-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#10b981" viewBox="0 0 256 256">
          <path d="M229.66,74.34l-112,112a8,8,0,0,1-11.32,0l-48-48a8,8,0,0,1,11.32-11.32L112,164.69,218.34,58.34a8,8,0,0,1,11.32,11.32Z"></path>
        </svg>
      </div>
      <div class="popup-confirmacion-title-section">
        <h2>¡Ticket creado exitosamente!</h2>
        <p>Tu ticket ha sido enviado correctamente</p>
      </div>
    </div>
    
    <!-- Código del ticket -->
    <div class="popup-ticket-code">
      <div class="ticket-code-label">Código del ticket:</div>
      <div class="ticket-code-value">
        <span id="popup-codigo-ticket">...</span>
        <button type="button" id="popup-copiar-codigo" class="copiar-btn" title="Copiar código">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256">
            <path d="M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32ZM160,208H48V96H160Zm48-48H176V88a8,8,0,0,0-8-8H96V48H208Z"></path>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Botones de acción -->
    <div class="pop-up-btns-row">
      <button type="button" class="btn-gris" id="cerrar-confirmacion">Cerrar</button>
      <button type="button" id="ver-mis-tickets" class="btn-verde">Ver mis tickets</button>
    </div>
  </div>
</div>

<script type="module" src="/js/user/nuevo_ticket.js"></script>